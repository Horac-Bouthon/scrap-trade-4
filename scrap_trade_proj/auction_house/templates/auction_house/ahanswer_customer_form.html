{% extends "project_main/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block style %}
{% if object.owner.customer_background %}
  <style>
    body {
      background-image: url("{{ object.owner.customer_background.url }}");
      background-repeat: no-repeat;
      background-size: cover;
  }
  </style>
{% endif %}
{% endblock style %}


{% block content %}
  <article class="media content-section">
    <a href="{% url 'project-customer-info' object.owner.pk %}" target="_blank">
      <img class="rounded-circle customer-logo" src="{{ object.owner.customer_logo.url }}">
    </a>
    <div class="media-body">
      <h2 class="customer-name">{{ object.customer_name }}</h2>
      <form class="" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset class="form-group">
          {{ form|crispy }}
        </fieldset>
        <div class="form-group">
          {% for next in object.actual_state.next_states.all %}
            {% if next.is_alert_button == False and next.manual_set == True %}
              {% if next.security_level > 0 %}
                {% if next.security_level == 1  and "customers.is_customer_admin" in perms %}
                  <a class="btn btn-outline-secondary" href="{% url 'ah-answer-change-state' object.owner.pk object.pk next.pk %}">{{ next.get_actual_state_button }}</a>
                {% endif %}
                {% if next.security_level > 1 and "customers.is_poweruser" in perms %}
                  <a class="btn btn-outline-secondary" href="{% url 'ah-answer-change-state' object.owner.pk object.pk next.pk %}">{{ next.get_actual_state_button }}</a>
                {% endif %}
              {% else %}
                <a class="btn btn-outline-secondary" href="{% url 'ah-answer-change-state' object.owner.pk object.pk next.pk %}">{{ next.get_actual_state_button }}</a>
              {% endif %}
            {% endif %}
          {% endfor %}
          {% for next in object.actual_state.next_states.all %}
            {% if next.is_alert_button == True and next.manual_set == True %}
              {% if next.security_level > 0 %}
                {% if next.security_level == 1  and "customers.is_customer_admin" in perms %}
                  <a class="btn btn-outline-danger" href="{% url 'ah-answer-change-state' object.owner.pk object.pk next.pk %}">{{ next.get_actual_state_button }}</a>
                {% endif %}
                {% if next.security_level > 1 and "customers.is_poweruser" in perms %}
                  <a class="btn btn-outline-danger" href="{% url 'ah-answer-change-state' object.owner.pk object.pk next.pk %}">{{ next.get_actual_state_button }}</a>
                {% endif %}
              {% else %}
                <a class="btn btn-outline-danger" href="{% url 'ah-answer-change-state' object.owner.pk object.pk next.pk %}">{{ next.get_actual_state_button }}</a>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
        <div class="form-group">
          {% trans "Update" as var_add %}
          <button class="btn btn-outline-info" type="submit">{{ var_add }}</button>
          {% trans "Cancel" as var_cancel %}
          <a class="btn btn-outline-secondary" href="{% url 'ah-answer-detail' object.pk %}">{{ var_cancel }}</a>
        </div>
      </form>
    </div>
  </article>
{% endblock content %}

{% block spec_action %}
{% endblock spec_action %}
