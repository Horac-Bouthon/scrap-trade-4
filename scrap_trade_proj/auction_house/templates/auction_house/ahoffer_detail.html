{% extends "project_main/base.html" %}
{% load static %}
{% load i18n %}

{% block content %}

    <article class="media content-section">
      <a href="{% url 'project-customer-info' object.owner.pk %}" target="_blank">
        <img class="rounded-circle customer-logo" src="{{ object.owner.customer_logo.url }}">
      </a>
      <div class="media-body">
        {% trans "Back to auction" as var_back %}
        <div class="auction_nav">
          <a class="btn btn-outline-secondary" href="{% url 'ah-customer-auction' object.owner.pk %}">{{ var_back }}</a>
          <p></p>
        </div>
        {% trans "Click to update offer" as var_hint1 %}
        <h2 class="customer-name">
          {% if "customers.is_poweruser" in perms or object.actual_state == state_new or object.actual_state == state_ready_to_close %}
            {% if "customers.is_poweruser" in perms %}
              <a class="" href="{% url 'ah-offer-update' object.pk %}" data-toggle="tooltip" data-placement="top" title="{{ var_hint1 }}">{{ object.description }}</a>
            {% else %}
              <a class="" href="{% url 'ah-offer-customer-update' object.pk %}" data-toggle="tooltip" data-placement="top" title="{{ var_hint1 }}">{{ object.description }}</a>
            {% endif %}
          {% else %}
            {{ object.description }}
          {% endif %}
        </h2>
        <p>
          {% trans "Status:" as var_status %}
          <span class="customer-detail-content-highlighit">{{ var_status }} </span>
          <span class="customer-detail-content">{{ object.actual_state.act_state_name }}</span>
        </p>
        <p>
          {% trans "Auction date:" as var_auction %}
          <span class="customer-detail-content-highlighite">{{ var_auction }} </span>
          <span class="customer-detail-content">{{ object.auction_date }}</span>
        </p>
        <p>
          {% trans "Delivery date:" as var_delivery %}
          <span class="customer-detail-content-highlighite">{{ var_delivery }} </span>
          <span class="customer-detail-content">{{ object.delivery_date }}</span>
        </p>
        <p>
          {% trans "Minimal total price:" as var_min_price %}
          <span class="customer-detail-content-highlighite">{{ var_min_price }} </span>
          <span class="customer-detail-content">{{ object.minimal_total_price }}</span>
        </p>
        <p/>
        {% if object.actual_state == state_new %}
          {% trans "Click to add offers line" as var_hint1 %}
          {% trans "Lines" as var_line_header %}
          <h5 class="customer-title">
            <a class="" href="{% url 'ah-offer-line-create' object.pk %}" data-toggle="tooltip" data-placement="top" title="{{ var_hint1 }}">{{ var_line_header }}</a>
          </h5>
        {% endif %}
        {% if object.lines.all.count > 0 %}
          <table class="table_lines">
            <tr class="table_lines">
              {% trans "ID" as var_o_n %}
              <th class="th_lines table_lines">{{ var_o_n }}</th>
              {% trans "Description" as var_des %}
              <th class="th_lines table_lines">{{ var_des }}</th>
              {% trans "Material class" as var_mc %}
              <th class="th_lines table_lines">{{ var_mc }}</th>
              {% trans "Amount" as var_crea %}
              <th class="th_lines table_lines">{{ var_crea }}</th>
              {% trans "Price" as var_price %}
              <th class="th_lines table_lines">{{ var_price }}</th>
              <th class="th_lines table_lines"></th>
            </tr>
            {% trans "Click to update line" as var_hint3 %}
            {% for line in  object.lines.all %}
            <tr class="table_lines">
              <td class="td_lines table_lines"> {{ line.id }} </td>
              <td class="td_lines table_lines">
                {% if object.actual_state == state_new %}
                  <a class="table_lines" href="{% url 'ah-offer-line-update' object.pk line.pk %}" data-toggle="tooltip" data-placement="top" title="{{ var_hint3 }}">
                   {{ line.description }}
                  </a>
                {% else %}
                  {{ line.description }}
                {% endif %}
              </td>
              <td class="td_lines table_lines">
                <a class="table_lines" href="{% url 'ah-mat-class-detail' line.mat_class.id %}" data-toggle="tooltip" data-placement="top" title="{{ line.mat_class.act_mat_class_description }}" target="_blank">
                 {{ line.mat_class.act_display_name }}
                </a>
              </td>
              <td class="td_lines table_lines"> {{ line.amount }} {{ line.mat_class.measurement_unit }} </td>
              <td class="td_lines table_lines"> {{ line.minimal_ppu }}</td>
              <td class="td_lines table_lines">
                <div class="">
                  {% url 'doc-repo-dokument-list' line.open_id.int_id as href %}
                  {% include 'doc_repo/__btn-icon-doc.html' %}
                </div>
                {% if object.actual_state == state_new %}
                  <div class="">
                    {% url 'ah-offer-line-delete' line.id as href %}
                    {% include 'project_main/__btn-icon-delete.html' %}
                  </div>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </table>

          {% if object.actual_state == state_confirmed%}
            {% if my_answers.count > 0 %}
              <p></p>
              {% trans "Answers" as var_answers_header %}
              <h5 class="customer-title">
                {{ var_answers_header }} ({{ answers_total }})
              </h5>
              <table class="table_lines">
                <tr class="table_lines">
                  {% trans "ID" as var_o_n %}
                  <th class="th_lines table_lines">{{ var_o_n }}</th>
                  {% trans "Total price" as var_des %}
                  <th class="th_lines table_lines">{{ var_des }}</th>
                </tr>
                {% trans "Click to update line" as var_hint3 %}
                {% for answer in  my_answers %}
                  <tr class="table_lines">
                    <td class="td_lines table_lines"> {{ answer.id }} </td>
                    <td class="td_lines table_lines">
                        {{ answer.total_price }}
                    </td>
                  </tr>
                {% endfor %}
              </table>
            {% endif %}
          {% endif %}
          {% if object.actual_state == state_accepted or object.actual_state == state_ready_to_close or object.actual_state == state_closed %}
            {% if bound_answers.count > 0 %}
              {% for answer in  bound_answers %}
`                <p></p>
                {% trans "Answer" as var_answer_header %}
                <h5 class="customer-title">
                  {{ var_answer_header }}
                </h5>


                <h5>
                  <a class=""
                    href="{% url 'project-customer-info' answer.owner.pk %}" target="_blank">
                    <img class="rounded-circle customer-logo" src="{{ answer.owner.customer_logo.url }}">
                    {{ answer.owner.customer_name }}
                  </a>
                </h5>
                <h2 class="customer-name">{{ answer.description }}</h2>
                <p>
                  {% trans "Status:" as var_status %}
                  <span class="customer-detail-content-highlighite">{{ var_status }} </span>
                  <span class="customer-detail-content">{{ answer.actual_state.act_state_name }}</span>
                </p>
                <p>
                  {% trans "Answer total:" as var_at %}
                  <span class="customer-detail-content-highlighite">{{ var_at }} </span>
                  <span class="customer-detail-content">{{ answer.total_price }}</span>
                </p>
                <p/>
                {% if answer.my_lines.all.count > 0 %}
                  <table class="table_lines">
                    <tr class="table_lines">
                      {% trans "ID" as var_o_n %}
                      <th class="th_lines table_lines">{{ var_o_n }}</th>
                      {% trans "Description" as var_offer_des %}
                      <th class="th_lines table_lines">{{ var_offer_des }}</th>
                      {% trans "Material class" as var_mc %}
                      <th class="th_lines table_lines">{{ var_mc }}</th>
                      {% trans "Amount" as var_crea %}
                      <th class="th_lines table_lines">{{ var_crea }}</th>
                      {% trans "Price per unit" as var_ppu %}
                      <th class="th_lines table_lines">{{ var_ppu }}</th>
                      {% trans "Price total" as var_line_total %}
                      <th class="th_lines table_lines">{{ var_line_total }}</th>
                    </tr>
                    {% for line in  answer.my_lines.all %}
                      <tr class="table_lines">
                        <td class="td_lines table_lines"> {{ line.id }} </td>
                        <td class="td_lines table_lines">
                          {{ line.offer_line.description }}
                        </td>
                        <td class="td_lines table_lines">
                            {{ line.offer_line.mat_class.act_display_name }}
                        </td>
                        <td class="td_lines table_lines"> {{ line.offer_line.amount }} {{ line.offer_line.mat_class.measurement_unit }} </td>
                        <td class="td_lines table_lines">
                            {{ line.ppu }}
                        </td>
                        <td class="td_lines table_lines">
                            {{ line.total_price }}
                        </td>
                      </tr>
                    {% endfor %} <!-- answer.my_lines.all -->
                  </table>
                  {% if answer.open_id.get_docs.count > 0 %}
                    <div class="">
                      <p></p>
                      {% trans "Answer documents" as var_docs %}
                      <h5 class="">{{ var_docs }}</h5>
                      {% include 'doc_repo/__object_docs.html' with object=answer %}
                    </div>
                  {% endif %}

                {% endif %} <!-- answer.my_lines.all.count > 0 -->
              {% endfor %} <!-- bounut answers -->
`           {% endif %} <!-- bound_answers.count > 0 -->
          {% endif %} <!-- accepted, ready to close, closed -->
        {% endif %} <!-- object.lines.all.count > 0 -->
        {% if "customers.is_poweruser" in perms %}
          <div class="">
            <p></p>
            {% trans "State history" as var_state_history %}
            <h5 class="customer-title">
              {{ var_state_history }}
            </h5>
            <table class="table_lines">
              <tr class="table_lines">
                {% trans "ID" as var_o_n %}
                <th class="th_lines table_lines">{{ var_o_n }}</th>
                {% trans "State" as var_state %}
                <th class="th_lines table_lines">{{ var_state }}</th>
                {% trans "Create by" as var_created_by %}
                <th class="th_lines table_lines">{{ var_created_by }}</th>
                {% trans "Create at" as var_created_at %}
                <th class="th_lines table_lines">{{ var_created_at }}</th>
              </tr>
              {% for step in object.get_steps %}
                <tr class="table_lines">
                  <td class="td_lines table_lines"> {{ step.id }} </td>
                  <td class="td_lines table_lines"> {{ step.state.act_state_name }} </td>
                  <td class="td_lines table_lines"> {{ step.changed_by.name }} </td>
                  <td class="td_lines table_lines"> {{ step.created_at }} </td>
                </tr>
              {% endfor %} <!-- object.get_steps -->
            </table>
          </div>
        {% endif %} <!-- "customers.is_poweruser" in perms -->
        <div class="">
          {% trans "Documents" as var_doc %}
          <a class="btn btn-outline-secondary float-right" href="{% url 'doc-repo-dokument-list' object.open_id.int_id %}">{{ var_doc }}</a>
        </div>
      </div>
    </article>


{% endblock content %}

{% block spec_action %}
{% endblock spec_action %}
