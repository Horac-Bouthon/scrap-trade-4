
{% extends 'project_main/base.html' %}

{% load i18n %}
{% load crispy_forms_tags %}


{% block content %}

  {% if arrival == 'wrong_state' %}

    <section class="content-pad">
      <dl class="h5 py-5
                 mx-md-4 mx-lg-5">
        
        <h4 class="mb-4 font-weight-bold">
          {% trans "This offer is not in auction yet." %}
        </h4>
      </dl>
    </section>

    

  {% elif arrival == 'too_soon' %}

    <section class="content-pad">
      <dl class="h5 py-5
                 mx-md-4 mx-lg-5">

        <h4 class="mb-4 font-weight-bold">
          {% trans "This auction has not started yet." %}
        </h4>

        <dt>{% trans "Auction is starting at: " %}</dt>
        <dd>{{ offer.auction_start|date:"d.m.Y" }} {{ offer.auction_start|time:"H:i" }}</dd>
      </dl>
    </section>





  {% elif arrival == 'too_late' %}

    <section class="content-pad">
      <dl class="h5 py-5
                 mx-md-4 mx-lg-5">

        <h4 class="mb-4 font-weight-bold">
          {% trans "This auction has already ended." %}
        </h4>
      </dl>
    </section>

    {# @todo; Get some info about the auction? Description at least? #}




  {% elif arrival == 'ok' %}

    {% include 'project_main/__content-header.html' %}

    <section class="content-pad">

      <dl>
        <h4>{% trans "Auction details" %}</h4>

        <div class="d-flex">
          <dl>
            <dt>{% trans 'Minimal total price:' %}</dt>
            <dd>{{ offer.minimal_total_price }}</dd>
          </dl>
          <dl>
            <dt>{% trans 'Delivery date:' %}</dt>
            <dd>{{ offer.delivery_date|date:"d.m.Y" }}</dd>
          </dl>
          <dl>
            <dt>{% trans 'Auction end:' %}</dt>
            <dd>{{ offer.auction_end|date:"d.m.Y" }} {{ offer.auction_end|time:"H:i" }}</dd>
          </dl>
        </div>

        <h4>{% trans "Offer lines" %}</h4>

        {% include 'auction_house/__offerlines-table.html' %}

      </dl>

      <div class="d-flex">

        <dl class="flex-fill">
          
          <h4>{% trans "My bid" %}</h4>
          
          <dt>{% trans 'Total price:' %}</dt>
          <dd>{{ answer.total_price }}</dd>
          
          <div class="table-wrap">
            <table>
              <tr>
                <th>{% trans "Description" %}</th>
                <th>{% trans "Amount" %}</th>
                <th>{% trans "Price per unit" %}</th>
              </tr>
              
              {% for line_obj in lines %}  
                <tr class="{{ line_obj.str_class }}">
                  {% with line=line_obj.ah_a_line %}
                    <td>{{ line.offer_line.description }}</td>
                    <td>{{ line.offer_line.amount }} {{ line.offer_line.mat_class.measurement_unit }}</td>
                    <td>
                      <a href="{% url 'ah-customer-answers-online-ppu' answer.pk line_obj.ah_a_line.pk %}"
                         title="{% trans "Click to update price per unit" %}">
                        <div class="d-flex">
                          {{ line.ppu }}
                          <i data-feather="edit-3"></i>
                        </div>
                      </a>
                    </td>
                  {% endwith %}
                </tr>
              {% endfor %}
            </table>
          </div>

        </dl>

        <dl class="ml-3">
          <h4 class="m-0">
            {% trans "Best bids" %}
          </h4>

          <ul class="bid__list">
            {% for bid in ordered_best_bid_list %}
              <li class="{{ bid.str_class }}">
                <div class="bid__amount">
                  {{ bid.total_price }}
                </div>
              </li>
            {% endfor %}
          </ul>
        </dl>
      </div>

    </section>

    <style>
     .bid__list {
         padding-left: 0;
         list-style: none;
     }
     .bid__item {
         padding: 0.25rem 1.5rem;
         margin: 0.5rem 0;

         background: white;
         border: 1px solid #dee2e6;
         border-radius: 0.25rem;
         box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);

         display: flex;
         align-items: center;
     }
     .bid__time {
         color: #6c757d;
         text-align: right;
         width: 3rem;
         margin-top: 10px;  /* slight off-center */
     }
     .bid__amount {
         text-align: right;
         font-weight: bold;
         font-size: 2.5rem;
         line-height: 1.15em;

         padding-right: 0.25rem;

         flex: 1 1 auto; /* flex-fill */
     }
     .bid__item--best {
         background: #ff5 !important;
     }
     .bid__item--owned {
         color: var(--orange);
     }
    </style>

  {% endif %}

{% endblock content %}
