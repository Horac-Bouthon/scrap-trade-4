{% extends "project_main/base.html" %}
{% load i18n %}


{% block content %}

  {% include 'project_main/__content-header.html' %}  
  
  <ol class="container 
             py-3
             list-unstyled">

    <section class="pb-2">
      {% if "customers.is_poweruser" in perms %}
        <a class="btn btn-outline-primary"
           href="{% url 'project-customer-new' %}"
           title="{% trans "Create a new customer" context "button-title" %}">
          <i data-feather="plus"></i>
          {% trans "Add customer" %}
        </a>
      {% endif %}
    </section>
    
    {% for customer in customers %}

      <li class="py-2">

        {# Header -- toggles the details below #}
        <section class="d-flex w-100 
                        bg-white rounded overflow-hidden border shadow-sm
                        mb-0">

          {# Logo #}
          <div class="d-flex align-self-center my-2 mx-1"
               style="width: 100px; height: 80px;">
            <img class="align-self-center m-auto 
                        h-100"
                 alt="{{ customer.customer_name }} logo"
                 src="{{ customer.customer_logo.url }}"/>
          </div>

          
          <div class="align-self-stretch border-right"></div> {# spacer #}

          
          <div class="flex-fill align-self-center text-left
                      px-2 py-3">
            {# Customer name #}
            <h3 class="mb-1 line-height-minimal d-block">
              {{ customer.customer_name }}
            </h3>
            {# Action buttons #}
            <section class="">

              <a class="btn btn-outline-info btn-sm"
                 href="{% url 'project-customer-info' customer.id %}"
                 title="{% trans "View detailed customer info" context "button-tooltip" %}">
                {% trans "Detail" %}
              </a>
              
              {% if user.customer == customer or "customers.is_poweruser" in perms %}
                <a class="btn btn-outline-primary btn-sm"
                   href="{% url 'ah-customer-auction' customer.id %}"
                   title="{% trans "View my auction page" context "button-tooltip" %}">
                  {% trans "Auction" context "button-text" %}
                </a>
              {% endif %}
            </section>
          </div>

          
          <div class="align-self-stretch border-right"></div> {# spacer #}

          
          {# Button with icon -- Openable list item #}
          <button class="btn btn-outline-secondary 
                         align-self-stretch border-0 rounded-0
                         px-lg-4"
                  data-toggle="collapse"
                  data-target="#Customer_Collapse_{{ forloop.counter }}"
                  aria-controls="Customer_Collapse_{{ forloop.counter }}"
                  title="{% trans "Toggle details" context "collapse-button-title" %}">
            <i data-feather="chevron-down"></i>
          </button>
          
        </section>

        {# Details #}
        <section class="collapse mx-2
                        bg-white 
                        border border-top-0 rounded-bottom shadow-sm"
                 id="Customer_Collapse_{{ forloop.counter }}">
          <div class="container p-3">

            {# Description #}
            {% if customer.act_short %}
              <p><big>
                {{ customer.act_short }}
              </big></p>
            {% endif %}
            

            {# Details #}
            <h4 class="border-bottom">
              Details
            </h4>
            
            {% if customer.customer_ICO %}
              <p class="mb-0">
                {% trans "Registration number:" %} </p>
              <p class="ml-3 font-weight-bold">
                {{ customer.customer_ICO }} </p>
            {% endif %}
            
            {% if customer.customer_DIC %}
              <p class="mb-0">
                {% trans "VAT:" %} </p>
              <p class="ml-3 font-weight-bold">
                {{ customer.customer_DIC }}</p>
            {% endif %}

            {# Addresses #}
            {% if customer.customerestablishments_set.all.count > 0 %} {# @sqlcall #}
              <h4 class="border-bottom">
                {% trans "Establishments" %}
              </h4>
              {% for address in customer.customerestablishments_set.all %}
                {# @todo; Use an include for displaying addresses #}
                <h5 class="">
                  {{ address.establishment}}
                </h5>
                <p class="m-0">
                  {{ address.address_street }} {{ address.address_number }}
                </p>
                <p class="m-0">
                  {{ address.address_zip_code }} {{ address.address_town }}
                </p>
              {% endfor %}
            {% endif %}

          </div>
        </section>
      </li>
      
    {% endfor %}
  </ol>
  
{% endblock content %}

{% block spec_action %}
  
  {% if "customers.is_poweruser" in perms %}
    <a class="btn btn-secondary"
       href="{% url 'project-customer-new' %}">
      {% trans "Add customer" context "right-navbar" %}
    </a>
  {% endif %}
  
{% endblock %}

